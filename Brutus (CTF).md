# Understanding Logs in Unix/Linux Systems

### What are Logs?

Logs are records that capture events, actions, or messages generated by the system or applications. In the context of Unix/Linux systems, logs are useful for troubleshooting, monitoring, and security auditing. They provide detailed information about system activities, user actions, errors, and more.

### Types of Logs in Unix/Linux

Unix/Linux systems generate various types of log files, each serving a specific purpose. Some common logs are:

1. **System Logs**: These logs provide details about the overall health of the system, like hardware status or operating system events.
2. **Authentication Logs**: These logs contain information about system authentication events, such as user logins, logouts, and attempts to access secured resources.
3. **Application Logs**: Logs generated by applications to capture their activity, errors, and statuses.

---

### Understanding the Files in Your Challenge

#### `auth.log`

- **What it is**: The `auth.log` file records authentication-related events. It logs successful and failed login attempts, sudo activity, SSH logins, user authentication, etc.
  
- **What it contains**:
    - Successful login attempts (e.g., via SSH, GUI login).
    - Failed login attempts (indicating potential brute force or unauthorized attempts).
    - Use of `sudo` commands.
    - Any authentication-related errors or issues.

#### `wtmp`

- **What it is**: The `wtmp` file keeps a record of all logins and logouts, system boots, and shutdowns. It stores information about user sessions and system events.

- **What it contains**:
    - User login/logout events.
    - Reboots of the system.
    - Shutdowns or restarts.

---

### Tools for Analyzing Logs

Here are some tools you can use to analyze logs in Unix/Linux:

- **`grep`**: For searching through log files.
  
    ```bash
    grep "pattern" /var/log/auth.log
    ```

- **`last`**: For viewing login history in the `wtmp` file.
  
    ```bash
    last
    ```

---

### Next Steps in the CTF

In your CTF challenge, you might be asked to:

- Find unusual or unauthorized login attempts in `auth.log`.
- Look for any signs of brute force or suspicious login activity.



Now that we have a basic understanding of what logs are, and what `auth.log` and `wtmp` are, you can begin analyzing your logs with these tools and concepts in mind. Good luck with your CTF challenge!

---

### **Task 1: Find the IP Address Used by the Attacker for Brute Force Attack**

In a brute force attack, an attacker typically tries many failed login attempts, usually for the same user account, from the same IP address.

**Search for Failed Login Attempts**: Use `grep` to look for failed login attempts in the `auth.log`. You can search for the phrase `Failed password`, which is usually logged when a login attempt fails.

```bash
grep "Failed password" /path/to/auth.log

```
---

### **Task 2: Identify the Username of the Account Compromised by the Attacker**

Once the attacker has successfully brute-forced an account, there should be an entry in the `auth.log` indicating a successful login.

**Search for Successful Logins**: Use `grep` to look for successful login attempts in the `auth.log`. You can search for the phrase `Accepted password`, which is usually logged when a login attempt is successful.

```bash
grep "Accepted password" /path/to/auth.log

```
---

### Task 3: Identify the Timestamp When the Attacker Manually Logged in to the Server

The first logon to the root account was done via automated brute forcing. Continuing to scroll through the `auth.log`, we find that the attacker manually logs in as the root user and starts adding a new user and group on the box named **cyberjunkie**.

To confirm this, you can check the `wtmp` file, which contains records of user logins, logouts, system reboots, and other related events. 

You can use the following command to dump the contents of the `wtmp` file:

```bash
utmpdump wtmp
````
>It looks like the logged timestamp of the manual login by the attacker is 2024â€“03â€“06 06:32:45.

---

### **Task 4: Find the Session Number Assigned to the Attacker's SSH Session**

SSH login sessions are tracked and assigned a session number upon login. To find the session number assigned to the attacker's session for the user account (identified in Task 2), we can use the following steps.

**Find Session Information**: Use the `grep` command to search for the session information in the `auth.log` file:

```bash
grep "session" auth.log
```
***output***
```bash
Mar  6 06:32:44 ip-172-31-35-28 systemd-logind[411]: New session 37 of user root.
```
>This session number (e.g., 37) matches the login time identified in the previous task, confirming the attacker's session.

---

### **Task 5: The Attacker Added a New User with Higher Privileges**

The attacker added a new user as part of their persistence strategy on the server and gave this new user account higher privileges. To identify the name of this account, we can search for the `useradd` command in the `auth.log`.

**Search for User Creation Events**: Use the `grep` command to search for `useradd` in the `auth.log`.

```bash
grep -i "useradd" auth.log
```
```bash
Mar  6 06:34:18 ip-172-31-35-28 useradd[2592]: new user: name=cyberjunkie, UID=1002, GID=1002, home=/home/cyberjunkie, shell=/bin/bash, from=/dev/pts/1
```
>This confirms that the attacker created a new user account named cyberjunkie

---

### Task 6: MITRE ATT&CK Sub-technique for Persistence via Account Creation

#### MITRE ATT&CK and Persistence via Account Creation

##### What is MITRE ATT&CK?
The MITRE ATT&CK framework is a comprehensive knowledge base of adversary tactics, techniques, and procedures (TTPs) used in cybersecurity attacks. It provides a detailed and standardized classification of how attackers operate during different phases of an attack. This framework helps organizations understand how attackers may exploit their systems and how to detect, respond, and mitigate such activities.

##### What is Persistence?
Persistence refers to techniques used by attackers to maintain access to a system or network even after the initial attack vector has been closed or detected. This is critical for attackers to ensure they can continue their operations without needing to repeatedly exploit vulnerabilities.

##### Sub-technique for Persistence: T1136.001
One of the common persistence techniques used by attackers is creating new user accounts on the compromised system. This allows the attacker to maintain access even if the original attack vector is closed.

- **T1136: Create Account**  
    - This technique involves creating a new account on the system to maintain access.
  
- **T1136.001: Local Account**  
    - The **.001** sub-technique specifically refers to the creation of a local user account. This is when an attacker adds a new user to the local system to ensure they can log in, even if other methods (like backdoors) are detected and removed.

>In our case, after the attacker added the user `cyberjunkie`, it would be classified under **T1136.001**.

---


